# Tryhackme 1 August 2021
## Attacktive Directory Room

>Impacket

Installing this software simply requires cloning the git repo and install the python libraries it needs.

1. git clone https://github.com/SecureAuthCorp/impacket.git /opt/impacket
1. pip3 install -r /opt/impacket/requirements.txt
1. cd /opt/impacket/ && python3 ./setup.py install

Above steps will download and install in its own /opt/impacket directory. On my Kali machine, it required sudo permissions. Just needs to ensure the machine has Python3 installed.

>Bloodhound and Neo4j

These two programs area also required.

The command is as follow:
- apt install bloodhound neo4j

apt update & apt upgrade should be run too otherwise they will fail to install

### Enumeration

As usual, use nmap to scan for open ports.

>sudo nmap -A  10.10.139.138 -oN  adirectory.out -vv

Command used

```bash
└─$ grep open adirectory.out                                                                    130 ⨯
53/tcp   open  domain        syn-ack ttl 125 Simple DNS Plus
80/tcp   open  http          syn-ack ttl 125 Microsoft IIS httpd 10.0
88/tcp   open  kerberos-sec  syn-ack ttl 125 Microsoft Windows Kerberos (server time: 2021-08-01 10:14:39Z)
135/tcp  open  msrpc         syn-ack ttl 125 Microsoft Windows RPC
139/tcp  open  netbios-ssn   syn-ack ttl 125 Microsoft Windows netbios-ssn
389/tcp  open  ldap          syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds? syn-ack ttl 125
464/tcp  open  kpasswd5?     syn-ack ttl 125
593/tcp  open  ncacn_http    syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped    syn-ack ttl 125
3268/tcp open  ldap          syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped    syn-ack ttl 125
3389/tcp open  ms-wbt-server syn-ack ttl 125 Microsoft Terminal Services
```

>What tool will allow us to enumerate port 139/445?

Tryhackme particularly asked what tool to enumerate port 139/445. The file output and what these ports are know for generally suggests these they are *SMB* shares so *enum4linux* can be used.

```
The syntax of Enum4Linux is nice and simple: "enum4linux [options] ip"

TAG            FUNCTION

-U             get userlist
-M             get machine list
-N             get namelist dump (different from -U and-M)
-S             get sharelist
-P             get password policy information
-G             get group and member list

-A             all of the above (full basic enumeration)
```

>enum4linuyx -A <target-ip>

Above command is used to get all details.

``` bash
 ============================================ 
|    Getting domain SID for 10.10.139.138    |
 ============================================ 
Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 359.
Domain Name: THM-AD
Domain Sid: S-1-5-21-3591857110-2884097990-301047963
[+] Host is part of a domain (not a workgroup)
```
>What is the NetBIOS-Domain Name of the machine?

THM-AD

>Kerbrute

A program to bruteforce an active directory. Installation steps is a bit tedious. But the steps are:

1. Go to its Github repo at https://github.com/ropnop/kerbrute
1. Download the appropriate version (next step assumes it's a linux distribution)
1. Rename the download file to kerbrute for easy identification
1. Run 'chmod +x kerbrute' to allow it to be executable

>What command within Kerbrute will allow us to enumerate valid usernames?

userenum. use ./kerberos -h to find out.


